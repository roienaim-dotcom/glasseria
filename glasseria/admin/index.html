<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glasseria - ×¤×× ×œ × ×™×”×•×œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #1a1a1a; --secondary: #666; --light: #f5f5f5; --white: #fff; --success: #27ae60; --danger: #e74c3c; }
        body { font-family: 'Heebo', sans-serif; background: var(--light); min-height: 100vh; }
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-box { background: var(--white); padding: 40px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .login-box h1 { font-size: 28px; margin-bottom: 10px; }
        .login-box p { color: var(--secondary); margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; text-align: right; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border: 2px solid #eee; border-radius: 8px; font-family: inherit; font-size: 14px; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-family: inherit; font-size: 14px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: var(--primary); color: var(--white); width: 100%; }
        .btn-primary:hover { background: #333; }
        .btn-danger { background: var(--danger); color: var(--white); }
        .btn-secondary { background: var(--light); color: var(--primary); }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        .admin-container { display: none; }
        .admin-header { background: var(--primary); color: var(--white); padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .admin-header h1 { font-size: 20px; }
        .admin-nav { display: flex; background: var(--white); border-bottom: 1px solid #eee; overflow-x: auto; }
        .admin-nav button { padding: 16px 24px; border: none; background: none; font-family: inherit; font-size: 14px; font-weight: 500; color: var(--secondary); cursor: pointer; border-bottom: 3px solid transparent; white-space: nowrap; }
        .admin-nav button:hover { color: var(--primary); }
        .admin-nav button.active { color: var(--primary); border-bottom-color: var(--primary); }
        .admin-content { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .section { display: none; }
        .section.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--white); padding: 24px; border-radius: 12px; text-align: center; }
        .stat-number { font-size: 36px; font-weight: 700; color: var(--primary); }
        .stat-label { color: var(--secondary); margin-top: 8px; }
        .card { background: var(--white); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .card-header h2 { font-size: 18px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #eee; }
        th { font-weight: 600; color: var(--secondary); font-size: 12px; text-transform: uppercase; }
        .table-image { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; }
        .actions { display: flex; gap: 8px; }
        .btn-icon { width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center; padding: 0; }
        .drag-handle { cursor: grab; color: #999; font-size: 18px; padding: 0 8px; }
        .drag-handle:hover { color: #333; }
        .sortable-ghost { opacity: 0.4; background: #e3f2fd; }
        .sortable-chosen { background: #e8f5e9; }
        .reorder-notice { background: #e3f2fd; border: 1px solid #90caf9; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 13px; color: #1565c0; display: flex; align-items: center; gap: 8px; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--white); border-radius: 16px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 18px; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--secondary); }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 20px; border-top: 1px solid #eee; display: flex; gap: 10px; justify-content: flex-end; }
        .image-upload { border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; }
        .image-upload:hover { border-color: var(--primary); }
        .image-upload input { display: none; }
        .image-preview { margin-top: 10px; }
        .image-preview img { max-width: 100%; max-height: 150px; border-radius: 8px; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
        .checkbox-item { display: flex; align-items: center; gap: 6px; padding: 8px 12px; background: var(--light); border-radius: 6px; cursor: pointer; }
        .checkbox-item:hover { background: #e8e8e8; }
        .checkbox-item input { width: auto; }
        .custom-input-row { display: flex; gap: 8px; margin-top: 10px; }
        .custom-input-row input { flex: 1; padding: 8px 12px; border: 2px solid #eee; border-radius: 6px; font-family: inherit; font-size: 13px; }
        .custom-input-row input:focus { outline: none; border-color: var(--primary); }
        .custom-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .custom-tag { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: #e3f2fd; border-radius: 20px; font-size: 13px; color: #1565c0; }
        .custom-tag .remove-tag { cursor: pointer; font-weight: bold; color: #c62828; margin-right: 4px; }
        .compression-status { background: #e8f5e9; border: 1px solid #a5d6a7; border-radius: 8px; padding: 10px; margin-top: 10px; font-size: 12px; color: #2e7d32; }
        .compression-status.compressing { background: #fff3e0; border-color: #ffcc80; color: #e65100; }
        .loading { text-align: center; padding: 40px; color: var(--secondary); }
        .spinner { width: 40px; height: 40px; border: 3px solid #eee; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-message { background: #ffebee; color: var(--danger); padding: 12px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .error-message.show { display: block; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; padding: 10px 0; }
        .product-card-mini { background: var(--white); border: 2px solid #eee; border-radius: 12px; padding: 12px; cursor: grab; position: relative; }
        .product-card-mini:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .product-card-mini img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
        .product-card-mini h4 { font-size: 14px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-card-mini .sku { font-size: 11px; color: var(--secondary); }
        .product-card-mini .order-badge { position: absolute; top: 8px; left: 8px; background: var(--primary); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
        .product-card-mini .actions-mini { display: flex; gap: 6px; margin-top: 10px; }
        .product-card-mini .actions-mini button { flex: 1; padding: 6px; font-size: 12px; }
        .view-toggle { display: flex; gap: 8px; background: var(--light); padding: 4px; border-radius: 8px; }
        .view-toggle button { padding: 8px 16px; border: none; background: none; border-radius: 6px; cursor: pointer; font-family: inherit; font-size: 13px; }
        .view-toggle button.active { background: var(--white); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        @media (max-width: 768px) {
            .admin-nav button { padding: 12px 16px; font-size: 13px; }
            .card-header { flex-direction: column; align-items: flex-start; }
            table { font-size: 13px; }
            th, td { padding: 8px; }
            .actions { flex-direction: column; }
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="login-container" id="login-screen">
        <div class="login-box">
            <h1>ğŸ” ×¤×× ×œ × ×™×”×•×œ</h1>
            <p>Glasseria - ××¢×¨×›×ª × ×™×”×•×œ ×§×˜×œ×•×’</p>
            <div class="error-message" id="login-error"></div>
            <form id="login-form">
                <div class="form-group"><label>××™××™×™×œ</label><input type="email" id="login-email" required placeholder="admin@glasseria.co.il"></div>
                <div class="form-group"><label>×¡×™×¡××”</label><input type="password" id="login-password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
                <button type="submit" class="btn btn-primary">×”×ª×—×‘×¨</button>
            </form>
        </div>
    </div>
    
    <div class="admin-container" id="admin-panel">
        <header class="admin-header">
            <h1>ğŸ“¦ Glasseria - × ×™×”×•×œ</h1>
            <button class="btn btn-secondary" id="logout-btn">×”×ª× ×ª×§</button>
        </header>
        <nav class="admin-nav">
            <button class="active" data-section="dashboard">ğŸ“Š ×“×©×‘×•×¨×“</button>
            <button data-section="categories">ğŸ“ ×§×˜×’×•×¨×™×•×ª</button>
            <button data-section="subcategories">ğŸ“‚ ×ª×ª-×§×˜×’×•×¨×™×•×ª</button>
            <button data-section="products">ğŸ“¦ ××•×¦×¨×™×</button>
        </nav>
        <main class="admin-content">
            <section class="section active" id="section-dashboard">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-number" id="stat-categories">0</div><div class="stat-label">×§×˜×’×•×¨×™×•×ª</div></div>
                    <div class="stat-card"><div class="stat-number" id="stat-subcategories">0</div><div class="stat-label">×ª×ª-×§×˜×’×•×¨×™×•×ª</div></div>
                    <div class="stat-card"><div class="stat-number" id="stat-products">0</div><div class="stat-label">××•×¦×¨×™×</div></div>
                </div>
                <div class="card">
                    <h2>ğŸ‘‹ ×‘×¨×•×š ×”×‘× ×œ×¤×× ×œ ×”× ×™×”×•×œ</h2>
                    <p style="margin-top: 10px; color: var(--secondary);">×›××Ÿ ×ª×•×›×œ ×œ× ×”×œ ××ª ×”×§×˜×œ×•×’ ×©×œ×š.</p>
                    <div style="margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                        <p style="color: #2e7d32; margin-bottom: 8px;"><strong>âœ¨ ×ª×›×•× ×•×ª:</strong></p>
                        <ul style="color: #2e7d32; margin-right: 20px; font-size: 14px;">
                            <li>âœ… ×“×—×™×¡×ª ×ª××•× ×•×ª ××•×˜×•××˜×™×ª</li>
                            <li>âœ… ××™×“×•×ª ×•×¦×‘×¢×™× ××•×ª×××™× ××™×©×™×ª</li>
                            <li>âœ… ×¡×™×“×•×¨ ××•×¦×¨×™× ×‘×’×¨×™×¨×”</li>
                        </ul>
                    </div>
                </div>
            </section>
            <section class="section" id="section-categories">
                <div class="card">
                    <div class="card-header"><h2>ğŸ“ ×§×˜×’×•×¨×™×•×ª</h2><button class="btn btn-primary" onclick="openCategoryModal()">+ ×”×•×¡×£ ×§×˜×’×•×¨×™×”</button></div>
                    <div id="categories-loading" class="loading"><div class="spinner"></div>×˜×•×¢×Ÿ...</div>
                    <table id="categories-table" style="display: none;"><thead><tr><th>×ª××•× ×”</th><th>×©×</th><th>×¡×“×¨</th><th>×¤×¢×•×œ×•×ª</th></tr></thead><tbody id="categories-tbody"></tbody></table>
                </div>
            </section>
            <section class="section" id="section-subcategories">
                <div class="card">
                    <div class="card-header"><h2>ğŸ“‚ ×ª×ª-×§×˜×’×•×¨×™×•×ª</h2><button class="btn btn-primary" onclick="openSubcategoryModal()">+ ×”×•×¡×£ ×ª×ª-×§×˜×’×•×¨×™×”</button></div>
                    <div id="subcategories-loading" class="loading"><div class="spinner"></div>×˜×•×¢×Ÿ...</div>
                    <table id="subcategories-table" style="display: none;"><thead><tr><th>×ª××•× ×”</th><th>×©×</th><th>×§×˜×’×•×¨×™×”</th><th>×¡×“×¨</th><th>×¤×¢×•×œ×•×ª</th></tr></thead><tbody id="subcategories-tbody"></tbody></table>
                </div>
            </section>
            <section class="section" id="section-products">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ“¦ ××•×¦×¨×™×</h2>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <select id="filter-category" onchange="filterProducts()" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd;"><option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option></select>
                            <div class="view-toggle">
                                <button class="active" onclick="setProductsView('grid')" id="view-grid-btn">ğŸ”² ×¨×©×ª</button>
                                <button onclick="setProductsView('table')" id="view-table-btn">ğŸ“‹ ×˜×‘×œ×”</button>
                            </div>
                            <button class="btn btn-primary" onclick="openProductModal()">+ ×”×•×¡×£ ××•×¦×¨</button>
                        </div>
                    </div>
                    <div class="reorder-notice" id="reorder-notice"><span>ğŸ’¡</span><span>×’×¨×•×¨ ××ª ×”××•×¦×¨×™× ×›×“×™ ×œ×©× ×•×ª ××ª ×¡×“×¨ ×”×ª×¦×•×’×” ×‘××ª×¨. ×”×©×™× ×•×™×™× × ×©××¨×™× ××•×˜×•××˜×™×ª!</span></div>
                    <div id="products-loading" class="loading"><div class="spinner"></div>×˜×•×¢×Ÿ...</div>
                    <div class="products-grid" id="products-grid" style="display: none;"></div>
                    <table id="products-table" style="display: none;"><thead><tr><th style="width: 30px;"></th><th>×ª××•× ×”</th><th>×©×</th><th>××§"×˜</th><th>××—×™×¨</th><th>×§×˜×’×•×¨×™×”</th><th>×¤×¢×•×œ×•×ª</th></tr></thead><tbody id="products-tbody"></tbody></table>
                </div>
            </section>
        </main>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="category-modal">
        <div class="modal">
            <div class="modal-header"><h3 id="category-modal-title">×”×•×¡×£ ×§×˜×’×•×¨×™×”</h3><button class="modal-close" onclick="closeCategoryModal()">&times;</button></div>
            <div class="modal-body">
                <form id="category-form">
                    <input type="hidden" id="category-id">
                    <div class="form-group"><label>×©× ×”×§×˜×’×•×¨×™×” *</label><input type="text" id="category-name" required></div>
                    <div class="form-group"><label>×¡×“×¨ ×ª×¦×•×’×”</label><input type="number" id="category-order" value="0"></div>
                    <div class="form-group">
                        <label>×ª××•× ×”</label>
                        <div class="image-upload" onclick="document.getElementById('category-image').click()">
                            <input type="file" id="category-image" accept="image/*" onchange="previewCategoryImage(this)">
                            <p>ğŸ“· ×œ×—×¥ ×œ×‘×—×™×¨×ª ×ª××•× ×”</p>
                            <div class="image-preview" id="category-image-preview"></div>
                        </div>
                        <div class="compression-status" id="category-compression-status" style="display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeCategoryModal()">×‘×™×˜×•×œ</button><button class="btn btn-primary" onclick="saveCategory()">×©××•×¨</button></div>
        </div>
    </div>

    <!-- Subcategory Modal -->
    <div class="modal-overlay" id="subcategory-modal">
        <div class="modal">
            <div class="modal-header"><h3 id="subcategory-modal-title">×”×•×¡×£ ×ª×ª-×§×˜×’×•×¨×™×”</h3><button class="modal-close" onclick="closeSubcategoryModal()">&times;</button></div>
            <div class="modal-body">
                <form id="subcategory-form">
                    <input type="hidden" id="subcategory-id">
                    <div class="form-group"><label>×§×˜×’×•×¨×™×” ×¨××©×™×ª *</label><select id="subcategory-category" required></select></div>
                    <div class="form-group"><label>×©× ×ª×ª-×”×§×˜×’×•×¨×™×” *</label><input type="text" id="subcategory-name" required></div>
                    <div class="form-group"><label>×¡×“×¨ ×ª×¦×•×’×”</label><input type="number" id="subcategory-order" value="0"></div>
                    <div class="form-group">
                        <label>×ª××•× ×”</label>
                        <div class="image-upload" onclick="document.getElementById('subcategory-image').click()">
                            <input type="file" id="subcategory-image" accept="image/*" onchange="previewSubcategoryImage(this)">
                            <p>ğŸ“· ×œ×—×¥ ×œ×‘×—×™×¨×ª ×ª××•× ×”</p>
                            <div class="image-preview" id="subcategory-image-preview"></div>
                        </div>
                        <div class="compression-status" id="subcategory-compression-status" style="display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeSubcategoryModal()">×‘×™×˜×•×œ</button><button class="btn btn-primary" onclick="saveSubcategory()">×©××•×¨</button></div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal-overlay" id="product-modal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header"><h3 id="product-modal-title">×”×•×¡×£ ××•×¦×¨</h3><button class="modal-close" onclick="closeProductModal()">&times;</button></div>
            <div class="modal-body">
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    <input type="hidden" id="product-order" value="0">
                    <div class="form-group"><label>×©× ×”××•×¦×¨ *</label><input type="text" id="product-name" required></div>
                    <div class="form-group"><label>××§"×˜</label><input type="text" id="product-sku"></div>
                    <div class="form-group"><label>××—×™×¨</label><input type="number" id="product-price" step="0.01"></div>
                    <div class="form-group"><label>×§×˜×’×•×¨×™×” *</label><select id="product-category" required onchange="updateProductSubcategories()"></select></div>
                    <div class="form-group"><label>×ª×ª-×§×˜×’×•×¨×™×”</label><select id="product-subcategory"><option value="">×œ×œ× ×ª×ª-×§×˜×’×•×¨×™×”</option></select></div>
                    <div class="form-group"><label>×¡×•×’/×“×’×</label><input type="text" id="product-type"></div>
                    <div class="form-group"><label>×ª×™××•×¨</label><textarea id="product-description" rows="3"></textarea></div>
                    <div class="form-group">
                        <label>××™×“×•×ª ×–××™× ×•×ª</label>
                        <div class="checkbox-group" id="sizes-checkboxes">
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="50"> 50</label>
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="60"> 60</label>
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="70"> 70</label>
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="80"> 80</label>
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="90"> 90</label>
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="100"> 100</label>
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="120"> 120</label>
                            <label class="checkbox-item"><input type="checkbox" name="sizes" value="150"> 150</label>
                        </div>
                        <div class="custom-tags" id="custom-sizes-tags"></div>
                        <div class="custom-input-row">
                            <input type="text" id="custom-size-input" placeholder="×”×•×¡×£ ××™×“×” ××•×ª×××ª ××™×©×™×ª...">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addCustomSize()">+ ×”×•×¡×£</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>×¦×‘×¢×™× ×–××™× ×™×</label>
                        <div class="checkbox-group" id="colors-checkboxes">
                            <label class="checkbox-item"><input type="checkbox" name="colors" value="×œ×‘×Ÿ"> ×œ×‘×Ÿ</label>
                            <label class="checkbox-item"><input type="checkbox" name="colors" value="×©×—×•×¨"> ×©×—×•×¨</label>
                            <label class="checkbox-item"><input type="checkbox" name="colors" value="××¤×•×¨"> ××¤×•×¨</label>
                            <label class="checkbox-item"><input type="checkbox" name="colors" value="××œ×•×Ÿ"> ××œ×•×Ÿ</label>
                            <label class="checkbox-item"><input type="checkbox" name="colors" value="××’×•×–"> ××’×•×–</label>
                            <label class="checkbox-item"><input type="checkbox" name="colors" value="×•× ×’×”"> ×•× ×’×”</label>
                        </div>
                        <div class="custom-tags" id="custom-colors-tags"></div>
                        <div class="custom-input-row">
                            <input type="text" id="custom-color-input" placeholder="×”×•×¡×£ ×¦×‘×¢ ××•×ª×× ××™×©×™×ª...">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addCustomColor()">+ ×”×•×¡×£</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>×ª××•× ×”</label>
                        <div class="image-upload" onclick="document.getElementById('product-image').click()">
                            <input type="file" id="product-image" accept="image/*" onchange="previewProductImage(this)">
                            <p>ğŸ“· ×œ×—×¥ ×œ×‘×—×™×¨×ª ×ª××•× ×”</p>
                            <div class="image-preview" id="product-image-preview"></div>
                        </div>
                        <div class="compression-status" id="product-compression-status" style="display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeProductModal()">×‘×™×˜×•×œ</button><button class="btn btn-primary" id="save-product-btn" onclick="saveProduct()">×©××•×¨</button></div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header"><h3>××™×©×•×¨ ××—×™×§×”</h3><button class="modal-close" onclick="closeDeleteModal()">&times;</button></div>
            <div class="modal-body"><p id="delete-message">×”×× ××ª×” ×‘×˜×•×—?</p></div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeDeleteModal()">×‘×™×˜×•×œ</button><button class="btn btn-danger" id="confirm-delete-btn">××—×§</button></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBaQbwRvxuraWb2ax6ijFNoxE6OXKhgVm8",
            authDomain: "glasseria-3761f.firebaseapp.com",
            projectId: "glasseria-3761f",
            storageBucket: "glasseria-3761f.firebasestorage.app",
            messagingSenderId: "1039571860801",
            appId: "1:1039571860801:web:1bb49bbf44bfd560ddb5c0"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();
        const categoriesCollection = db.collection('glasseria_categories');
        const subcategoriesCollection = db.collection('glasseria_subcategories');
        const productsCollection = db.collection('glasseria_products');
        
        // Image Compression
        async function compressImage(file, options = {}) {
            const { maxWidth = 1200, maxHeight = 1200, quality = 0.8 } = options;
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        let { width, height } = img;
                        if (width > maxWidth) { height = (height * maxWidth) / width; width = maxWidth; }
                        if (height > maxHeight) { width = (width * maxHeight) / height; height = maxHeight; }
                        const canvas = document.createElement('canvas');
                        canvas.width = width; canvas.height = height;
                        canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                        canvas.toBlob((blob) => blob ? resolve(blob) : reject(new Error('Compression error')), 'image/webp', quality);
                    };
                    img.onerror = () => reject(new Error('Image load error'));
                    img.src = e.target.result;
                };
                reader.onerror = () => reject(new Error('File read error'));
                reader.readAsDataURL(file);
            });
        }
        
        // State
        let categories = [], subcategories = [], products = [], currentUser = null;
        let productsView = 'grid', productsSortable = null, productsTableSortable = null;
        let customSizes = [], customColors = [];
        
        // Auth
        auth.onAuthStateChanged(user => {
            if (user) { currentUser = user; showAdminPanel(); loadAllData(); }
            else { currentUser = null; showLoginScreen(); }
        });
        
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await auth.signInWithEmailAndPassword(document.getElementById('login-email').value, document.getElementById('login-password').value);
                document.getElementById('login-error').classList.remove('show');
            } catch (error) {
                document.getElementById('login-error').textContent = '××™××™×™×œ ××• ×¡×™×¡××” ×©×’×•×™×™×';
                document.getElementById('login-error').classList.add('show');
            }
        });
        
        document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
        function showLoginScreen() { document.getElementById('login-screen').style.display = 'flex'; document.getElementById('admin-panel').style.display = 'none'; }
        function showAdminPanel() { document.getElementById('login-screen').style.display = 'none'; document.getElementById('admin-panel').style.display = 'block'; }
        
        // Navigation
        document.querySelectorAll('.admin-nav button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.admin-nav button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(`section-${btn.dataset.section}`).classList.add('active');
            });
        });
        
        // Load Data
        async function loadAllData() {
            categoriesCollection.orderBy('order').onSnapshot(snapshot => {
                categories = []; snapshot.forEach(doc => categories.push({ id: doc.id, ...doc.data() }));
                renderCategories(); updateCategorySelects();
                document.getElementById('stat-categories').textContent = categories.length;
            });
            subcategoriesCollection.orderBy('order').onSnapshot(snapshot => {
                subcategories = []; snapshot.forEach(doc => subcategories.push({ id: doc.id, ...doc.data() }));
                renderSubcategories();
                document.getElementById('stat-subcategories').textContent = subcategories.length;
            });
            productsCollection.orderBy('order').onSnapshot(snapshot => {
                products = []; snapshot.forEach(doc => products.push({ id: doc.id, ...doc.data() }));
                renderProducts();
                document.getElementById('stat-products').textContent = products.length;
            });
        }
        
        // Categories
        function renderCategories() {
            document.getElementById('categories-loading').style.display = 'none';
            document.getElementById('categories-table').style.display = 'table';
            document.getElementById('categories-tbody').innerHTML = categories.map(cat => `
                <tr><td><img src="${cat.image || '../images/placeholder.svg'}" class="table-image" onerror="this.src='../images/placeholder.svg'"></td>
                <td>${cat.name}</td><td>${cat.order || 0}</td>
                <td class="actions"><button class="btn btn-icon btn-secondary" onclick="editCategory('${cat.id}')">âœï¸</button><button class="btn btn-icon btn-danger" onclick="deleteCategory('${cat.id}')">ğŸ—‘ï¸</button></td></tr>
            `).join('');
        }
        
        function openCategoryModal(cat = null) {
            document.getElementById('category-modal').classList.add('active');
            document.getElementById('category-modal-title').textContent = cat ? '×¢×¨×™×›×ª ×§×˜×’×•×¨×™×”' : '×”×•×¡×£ ×§×˜×’×•×¨×™×”';
            if (cat) {
                document.getElementById('category-id').value = cat.id;
                document.getElementById('category-name').value = cat.name;
                document.getElementById('category-order').value = cat.order || 0;
                if (cat.image) document.getElementById('category-image-preview').innerHTML = `<img src="${cat.image}">`;
            } else {
                document.getElementById('category-form').reset();
                document.getElementById('category-id').value = '';
                document.getElementById('category-image-preview').innerHTML = '';
            }
            document.getElementById('category-compression-status').style.display = 'none';
        }
        function closeCategoryModal() { document.getElementById('category-modal').classList.remove('active'); }
        function editCategory(id) { const cat = categories.find(c => c.id === id); if (cat) openCategoryModal(cat); }
        
        async function previewCategoryImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = e => document.getElementById('category-image-preview').innerHTML = `<img src="${e.target.result}">`;
                reader.readAsDataURL(file);
                const statusEl = document.getElementById('category-compression-status');
                statusEl.textContent = `ğŸ“· ×’×•×“×œ ××§×•×¨×™: ${(file.size/1024).toFixed(1)}KB - ×™×™×“×—×¡ ×‘×©××™×¨×”`;
                statusEl.className = 'compression-status'; statusEl.style.display = 'block';
            }
        }
        
        async function saveCategory() {
            const id = document.getElementById('category-id').value;
            const name = document.getElementById('category-name').value;
            const order = parseInt(document.getElementById('category-order').value) || 0;
            const imageFile = document.getElementById('category-image').files[0];
            if (!name) { alert('× × ×œ××œ× ×©× ×§×˜×’×•×¨×™×”'); return; }
            const statusEl = document.getElementById('category-compression-status');
            try {
                let imageUrl = null;
                if (imageFile) {
                    statusEl.textContent = 'â³ ×“×•×—×¡ ×•××¢×œ×” ×ª××•× ×”...'; statusEl.className = 'compression-status compressing'; statusEl.style.display = 'block';
                    const blob = await compressImage(imageFile);
                    const ref = storage.ref(`glasseria/categories/${Date.now()}.webp`);
                    await ref.put(blob); imageUrl = await ref.getDownloadURL();
                    statusEl.textContent = `âœ… ×ª××•× ×” × ×“×—×¡×” ×œ-${(blob.size/1024).toFixed(1)}KB`; statusEl.className = 'compression-status';
                }
                const data = { name, order, updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                if (imageUrl) data.image = imageUrl;
                if (id) await categoriesCollection.doc(id).update(data);
                else { data.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await categoriesCollection.add(data); }
                closeCategoryModal();
            } catch (error) { alert('×©×’×™××”: ' + error.message); }
        }
        function deleteCategory(id) { openDeleteModal('×œ××—×•×§ ×§×˜×’×•×¨×™×” ×–×•?', async () => await categoriesCollection.doc(id).delete()); }
        
        // Subcategories
        function renderSubcategories() {
            document.getElementById('subcategories-loading').style.display = 'none';
            document.getElementById('subcategories-table').style.display = 'table';
            document.getElementById('subcategories-tbody').innerHTML = subcategories.map(sub => {
                const cat = categories.find(c => c.id === sub.categoryId);
                return `<tr><td><img src="${sub.image || '../images/placeholder.svg'}" class="table-image" onerror="this.src='../images/placeholder.svg'"></td>
                <td>${sub.name}</td><td>${cat ? cat.name : '-'}</td><td>${sub.order || 0}</td>
                <td class="actions"><button class="btn btn-icon btn-secondary" onclick="editSubcategory('${sub.id}')">âœï¸</button><button class="btn btn-icon btn-danger" onclick="deleteSubcategory('${sub.id}')">ğŸ—‘ï¸</button></td></tr>`;
            }).join('');
        }
        
        function openSubcategoryModal(sub = null) {
            document.getElementById('subcategory-modal').classList.add('active');
            document.getElementById('subcategory-modal-title').textContent = sub ? '×¢×¨×™×›×ª ×ª×ª-×§×˜×’×•×¨×™×”' : '×”×•×¡×£ ×ª×ª-×§×˜×’×•×¨×™×”';
            document.getElementById('subcategory-category').innerHTML = categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            if (sub) {
                document.getElementById('subcategory-id').value = sub.id;
                document.getElementById('subcategory-category').value = sub.categoryId;
                document.getElementById('subcategory-name').value = sub.name;
                document.getElementById('subcategory-order').value = sub.order || 0;
                if (sub.image) document.getElementById('subcategory-image-preview').innerHTML = `<img src="${sub.image}">`;
            } else {
                document.getElementById('subcategory-form').reset();
                document.getElementById('subcategory-id').value = '';
                document.getElementById('subcategory-image-preview').innerHTML = '';
            }
            document.getElementById('subcategory-compression-status').style.display = 'none';
        }
        function closeSubcategoryModal() { document.getElementById('subcategory-modal').classList.remove('active'); }
        function editSubcategory(id) { const sub = subcategories.find(s => s.id === id); if (sub) openSubcategoryModal(sub); }
        
        async function previewSubcategoryImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = e => document.getElementById('subcategory-image-preview').innerHTML = `<img src="${e.target.result}">`;
                reader.readAsDataURL(file);
                const statusEl = document.getElementById('subcategory-compression-status');
                statusEl.textContent = `ğŸ“· ×’×•×“×œ ××§×•×¨×™: ${(file.size/1024).toFixed(1)}KB - ×™×™×“×—×¡ ×‘×©××™×¨×”`;
                statusEl.className = 'compression-status'; statusEl.style.display = 'block';
            }
        }
        
        async function saveSubcategory() {
            const id = document.getElementById('subcategory-id').value;
            const categoryId = document.getElementById('subcategory-category').value;
            const name = document.getElementById('subcategory-name').value;
            const order = parseInt(document.getElementById('subcategory-order').value) || 0;
            const imageFile = document.getElementById('subcategory-image').files[0];
            if (!name || !categoryId) { alert('× × ×œ××œ× ×©×“×•×ª × ×“×¨×©×™×'); return; }
            const statusEl = document.getElementById('subcategory-compression-status');
            try {
                let imageUrl = null;
                if (imageFile) {
                    statusEl.textContent = 'â³ ×“×•×—×¡ ×•××¢×œ×” ×ª××•× ×”...'; statusEl.className = 'compression-status compressing'; statusEl.style.display = 'block';
                    const blob = await compressImage(imageFile);
                    const ref = storage.ref(`glasseria/subcategories/${Date.now()}.webp`);
                    await ref.put(blob); imageUrl = await ref.getDownloadURL();
                    statusEl.textContent = `âœ… ×ª××•× ×” × ×“×—×¡×” ×œ-${(blob.size/1024).toFixed(1)}KB`; statusEl.className = 'compression-status';
                }
                const data = { categoryId, name, order, updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                if (imageUrl) data.image = imageUrl;
                if (id) await subcategoriesCollection.doc(id).update(data);
                else { data.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await subcategoriesCollection.add(data); }
                closeSubcategoryModal();
            } catch (error) { alert('×©×’×™××”: ' + error.message); }
        }
        function deleteSubcategory(id) { openDeleteModal('×œ××—×•×§ ×ª×ª-×§×˜×’×•×¨×™×” ×–×•?', async () => await subcategoriesCollection.doc(id).delete()); }
        
        // Products
        function setProductsView(view) {
            productsView = view;
            document.getElementById('view-grid-btn').classList.toggle('active', view === 'grid');
            document.getElementById('view-table-btn').classList.toggle('active', view === 'table');
            document.getElementById('reorder-notice').style.display = view === 'grid' ? 'flex' : 'none';
            renderProducts();
        }
        
        function renderProducts() {
            document.getElementById('products-loading').style.display = 'none';
            const grid = document.getElementById('products-grid');
            const table = document.getElementById('products-table');
            const tbody = document.getElementById('products-tbody');
            const filterCategoryId = document.getElementById('filter-category').value;
            let filtered = filterCategoryId ? products.filter(p => p.categoryId === filterCategoryId) : products;
            filtered.sort((a, b) => (a.order || 0) - (b.order || 0));
            
            if (productsView === 'grid') {
                table.style.display = 'none'; grid.style.display = 'grid';
                grid.innerHTML = filtered.map((p, i) => `
                    <div class="product-card-mini" data-id="${p.id}">
                        <span class="order-badge">${i + 1}</span>
                        <img src="${p.image || '../images/placeholder.svg'}" onerror="this.src='../images/placeholder.svg'">
                        <h4>${p.name}</h4><div class="sku">${p.sku || '-'} | â‚ª${p.price || 0}</div>
                        <div class="actions-mini">
                            <button class="btn btn-secondary btn-small" onclick="editProduct('${p.id}')">âœï¸</button>
                            <button class="btn btn-danger btn-small" onclick="deleteProduct('${p.id}')">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `).join('');
                if (productsSortable) productsSortable.destroy();
                productsSortable = new Sortable(grid, { animation: 150, ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', onEnd: updateProductsOrder });
            } else {
                grid.style.display = 'none'; table.style.display = 'table';
                tbody.innerHTML = filtered.map(p => {
                    const cat = categories.find(c => c.id === p.categoryId);
                    return `<tr class="sortable-row" data-id="${p.id}">
                        <td><span class="drag-handle">â‹®â‹®</span></td>
                        <td><img src="${p.image || '../images/placeholder.svg'}" class="table-image" onerror="this.src='../images/placeholder.svg'"></td>
                        <td>${p.name}</td><td>${p.sku || '-'}</td><td>â‚ª${p.price || 0}</td><td>${cat ? cat.name : '-'}</td>
                        <td class="actions"><button class="btn btn-icon btn-secondary" onclick="editProduct('${p.id}')">âœï¸</button><button class="btn btn-icon btn-danger" onclick="deleteProduct('${p.id}')">ğŸ—‘ï¸</button></td>
                    </tr>`;
                }).join('');
                if (productsTableSortable) productsTableSortable.destroy();
                productsTableSortable = new Sortable(tbody, { animation: 150, handle: '.drag-handle', ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', onEnd: updateProductsOrder });
            }
        }
        
        async function updateProductsOrder() {
            const container = productsView === 'grid' ? document.getElementById('products-grid') : document.getElementById('products-tbody');
            const items = container.querySelectorAll('[data-id]');
            const batch = db.batch();
            items.forEach((item, i) => batch.update(productsCollection.doc(item.dataset.id), { order: i }));
            try { await batch.commit(); console.log('âœ… ×¡×“×¨ ×¢×•×“×›×Ÿ'); }
            catch (error) { alert('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¡×“×¨'); }
        }
        
        function filterProducts() { renderProducts(); }
        
        function updateCategorySelects() {
            const options = categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            document.getElementById('filter-category').innerHTML = '<option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>' + options;
            document.getElementById('product-category').innerHTML = '<option value="">×‘×—×¨ ×§×˜×’×•×¨×™×”</option>' + options;
        }
        
        function updateProductSubcategories() {
            const categoryId = document.getElementById('product-category').value;
            const subs = subcategories.filter(s => s.categoryId === categoryId);
            document.getElementById('product-subcategory').innerHTML = '<option value="">×œ×œ× ×ª×ª-×§×˜×’×•×¨×™×”</option>' + subs.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }
        
        // Custom Sizes & Colors
        function addCustomSize() {
            const input = document.getElementById('custom-size-input');
            const val = input.value.trim();
            if (val && !customSizes.includes(val)) { customSizes.push(val); renderCustomSizes(); input.value = ''; }
        }
        function removeCustomSize(i) { customSizes.splice(i, 1); renderCustomSizes(); }
        function renderCustomSizes() {
            document.getElementById('custom-sizes-tags').innerHTML = customSizes.map((s, i) => `<span class="custom-tag">${s}<span class="remove-tag" onclick="removeCustomSize(${i})">Ã—</span></span>`).join('');
        }
        
        function addCustomColor() {
            const input = document.getElementById('custom-color-input');
            const val = input.value.trim();
            if (val && !customColors.includes(val)) { customColors.push(val); renderCustomColors(); input.value = ''; }
        }
        function removeCustomColor(i) { customColors.splice(i, 1); renderCustomColors(); }
        function renderCustomColors() {
            document.getElementById('custom-colors-tags').innerHTML = customColors.map((c, i) => `<span class="custom-tag">${c}<span class="remove-tag" onclick="removeCustomColor(${i})">Ã—</span></span>`).join('');
        }
        
        document.getElementById('custom-size-input').addEventListener('keypress', e => { if (e.key === 'Enter') { e.preventDefault(); addCustomSize(); } });
        document.getElementById('custom-color-input').addEventListener('keypress', e => { if (e.key === 'Enter') { e.preventDefault(); addCustomColor(); } });
        
        function openProductModal(product = null) {
            document.getElementById('product-modal').classList.add('active');
            document.getElementById('product-modal-title').textContent = product ? '×¢×¨×™×›×ª ××•×¦×¨' : '×”×•×¡×£ ××•×¦×¨';
            customSizes = []; customColors = [];
            
            if (product) {
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-sku').value = product.sku || '';
                document.getElementById('product-price').value = product.price || '';
                document.getElementById('product-category').value = product.categoryId || '';
                document.getElementById('product-order').value = product.order || 0;
                updateProductSubcategories();
                document.getElementById('product-subcategory').value = product.subcategoryId || '';
                document.getElementById('product-type').value = product.type || '';
                document.getElementById('product-description').value = product.description || '';
                
                const predefinedSizes = ['50', '60', '70', '80', '90', '100', '120', '150'];
                document.querySelectorAll('input[name="sizes"]').forEach(cb => cb.checked = product.sizes && product.sizes.includes(cb.value));
                if (product.sizes) customSizes = product.sizes.filter(s => !predefinedSizes.includes(s));
                
                const predefinedColors = ['×œ×‘×Ÿ', '×©×—×•×¨', '××¤×•×¨', '××œ×•×Ÿ', '××’×•×–', '×•× ×’×”'];
                document.querySelectorAll('input[name="colors"]').forEach(cb => cb.checked = product.colors && product.colors.includes(cb.value));
                if (product.colors) customColors = product.colors.filter(c => !predefinedColors.includes(c));
                
                if (product.image) document.getElementById('product-image-preview').innerHTML = `<img src="${product.image}">`;
            } else {
                document.getElementById('product-form').reset();
                document.getElementById('product-id').value = '';
                document.getElementById('product-order').value = products.length;
                document.getElementById('product-image-preview').innerHTML = '';
            }
            renderCustomSizes(); renderCustomColors();
            document.getElementById('product-compression-status').style.display = 'none';
        }
        
        function closeProductModal() { document.getElementById('product-modal').classList.remove('active'); customSizes = []; customColors = []; }
        function editProduct(id) { const p = products.find(p => p.id === id); if (p) openProductModal(p); }
        
        async function previewProductImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = e => document.getElementById('product-image-preview').innerHTML = `<img src="${e.target.result}">`;
                reader.readAsDataURL(file);
                const statusEl = document.getElementById('product-compression-status');
                statusEl.textContent = `ğŸ“· ×’×•×“×œ ××§×•×¨×™: ${(file.size/1024).toFixed(1)}KB - ×™×™×“×—×¡ ×‘×©××™×¨×”`;
                statusEl.className = 'compression-status'; statusEl.style.display = 'block';
            }
        }
        
        async function saveProduct() {
            const id = document.getElementById('product-id').value;
            const name = document.getElementById('product-name').value;
            const sku = document.getElementById('product-sku').value;
            const price = parseFloat(document.getElementById('product-price').value) || 0;
            const categoryId = document.getElementById('product-category').value;
            const subcategoryId = document.getElementById('product-subcategory').value;
            const type = document.getElementById('product-type').value;
            const description = document.getElementById('product-description').value;
            const order = parseInt(document.getElementById('product-order').value) || 0;
            const imageFile = document.getElementById('product-image').files[0];
            
            if (!name || !categoryId) { alert('× × ×œ××œ× ×©× ××•×¦×¨ ×•×§×˜×’×•×¨×™×”'); return; }
            
            const checkedSizes = Array.from(document.querySelectorAll('input[name="sizes"]:checked')).map(cb => cb.value);
            const sizes = [...checkedSizes, ...customSizes];
            const checkedColors = Array.from(document.querySelectorAll('input[name="colors"]:checked')).map(cb => cb.value);
            const colors = [...checkedColors, ...customColors];
            
            const saveBtn = document.getElementById('save-product-btn');
            const statusEl = document.getElementById('product-compression-status');
            saveBtn.disabled = true; saveBtn.textContent = '×©×•××¨...';
            
            try {
                let imageUrl = null;
                if (imageFile) {
                    statusEl.textContent = 'â³ ×“×•×—×¡ ×•××¢×œ×” ×ª××•× ×”...'; statusEl.className = 'compression-status compressing'; statusEl.style.display = 'block';
                    const blob = await compressImage(imageFile);
                    const ref = storage.ref(`glasseria/products/${Date.now()}.webp`);
                    await ref.put(blob); imageUrl = await ref.getDownloadURL();
                    statusEl.textContent = `âœ… ×ª××•× ×” × ×“×—×¡×” ×œ-${(blob.size/1024).toFixed(1)}KB`; statusEl.className = 'compression-status';
                }
                
                const cat = categories.find(c => c.id === categoryId);
                const data = { name, sku, price, categoryId, subcategoryId: subcategoryId || null, category: cat ? cat.name : '', type, description, sizes, colors, order, updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                if (imageUrl) data.image = imageUrl;
                
                if (id) await productsCollection.doc(id).update(data);
                else { data.createdAt = firebase.firestore.FieldValue.serverTimestamp(); await productsCollection.add(data); }
                closeProductModal();
            } catch (error) { alert('×©×’×™××”: ' + error.message); }
            finally { saveBtn.disabled = false; saveBtn.textContent = '×©××•×¨'; }
        }
        
        function deleteProduct(id) { openDeleteModal('×œ××—×•×§ ××•×¦×¨ ×–×”?', async () => await productsCollection.doc(id).delete()); }
        
        // Delete Modal
        let deleteCallback = null;
        function openDeleteModal(msg, callback) {
            document.getElementById('delete-message').textContent = msg;
            document.getElementById('delete-modal').classList.add('active');
            deleteCallback = callback;
        }
        function closeDeleteModal() { document.getElementById('delete-modal').classList.remove('active'); deleteCallback = null; }
        document.getElementById('confirm-delete-btn').addEventListener('click', async () => { if (deleteCallback) { await deleteCallback(); closeDeleteModal(); } });
    </script>
</body>
</html>
